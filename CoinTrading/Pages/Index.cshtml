@page "{text?}"
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

@if (Model.Message != null)
{
    <div class="alert alert-primary" role="alert">
        @Model.Message
    </div>
}

@Html.Raw(HttpContext.Session.GetAlert())

<style>
    body {
        background-image: url('Images/bg.jpg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }

    table#priceTable td.positive-change {
        color: green;
        
    }

    table#priceTable td.negative-change {
        color: red;
       
    }

    .coin-icon {
        width: 24px;
        height: 24px;
        margin-right: 8px;
    }
</style>
<div class="text-center">
    <img src="Images/logo.png" alt="CoinTrade Logo" class="img-fluid" style="max-width: 500px;">
    <h3>Trade your coins and become a millionaire!</h3>
    <table id="priceTable" class="table table-bordered table-hover">
        <thead>
            <tr>
                <th>Coin</th>
                <th>Price $</th>
                <th>24h Change</th>
            </tr>
        </thead>
        <tbody>
            <!-- Rows will be added here by JavaScript -->
        </tbody>
    </table>
</div>

@section Scripts {
    <script>
        const coins = [
            { symbol: 'btcusdt', name: 'BTC', icon: 'Images/btclogo.png', decimalPlaces: 2 },
            { symbol: 'ethusdt', name: 'ETH', icon: 'Images/eth.png', decimalPlaces: 2 },
            { symbol: 'bnbusdt', name: 'BNB', icon: 'Images/bnb.png', decimalPlaces: 2 },
            { symbol: 'xrpusdt', name: 'XRP', icon: 'Images/xrp.png', decimalPlaces: 2 },
            { symbol: 'dogeusdt', name: 'DOGE', icon: 'Images/doge.png', decimalPlaces: 2 },
            { symbol: 'shibusdt', name: 'SHIBA INU', icon: 'Images/shiba.png', decimalPlaces: 8 },
            // Add other coins as needed
        ];

        const symbols = coins.map(coin => coin.symbol);
        const ws = new WebSocket('wss://stream.binance.com:9443/ws');

        ws.onopen = () => {
            const params = symbols.map(symbol => `${symbol}@@ticker`);
            const subscribeMessage = {
                method: 'SUBSCRIBE',
                params: params,
                id: 1
            };
            ws.send(JSON.stringify(subscribeMessage));
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            updateTable(data);
        };

        const printCoins {
            btcusdt: { icon: 'Images/btclogo.png', decimalPlaces: 2, price: 0, change: 0, class: 'positive-change' },
            ethusdt: { icon: 'Images/eth.png', decimalPlaces: 2, price: 0, change: 0, class: 'positive-change' },
            bnbusdt: { icon: 'Images/bnb.png', decimalPlaces: 2, price: 0, change: 0, class: 'positive-change' },
            xrpusdt: { icon: 'Images/xrp.png', decimalPlaces: 2, price: 0, change: 0, class: 'positive-change' },
            dogeusdt: { icon: 'Images/doge.png', decimalPlaces: 2, price: 0, change: 0, class: 'positive-change' },
            shibusdt: { icon: 'Images/shiba.png', decimalPlaces: 8, price: 0, change: 0, class: 'positive-change' },
        }

        const updateTable = (data) => {
            const coin = coins.find(c => c.symbol.toLowerCase() === data.s.toLowerCase());
            if (!coin) return;

            const table = document.getElementById('priceTable').getElementsByTagName('tbody')[0];
            let row = document.getElementById(data.s);

            if (!row) {
                row = table.insertRow();
                row.id = data.s;

                const cellCoin = row.insertCell(0);
                const cellPrice = row.insertCell(1);
                const cellChange = row.insertCell(2);

                cellCoin.innerHTML = `<img src='${coin.icon}' class='coin-icon' alt='${coin.name}'/>${coin.name}`;
                cellPrice.innerHTML = parseFloat(data.c).toFixed(coin.decimalPlaces);
                cellChange.innerHTML = `${parseFloat(data.P).toFixed(4)}%`;
                cellChange.className = parseFloat(data.P) >= 0 ? 'positive-change' : 'negative-change';
            } else {
                row.cells[1].innerHTML = parseFloat(data.c).toFixed(coin.decimalPlaces);
                row.cells[2].innerHTML = `${parseFloat(data.P).toFixed(4)}%`;
                row.cells[2].className = parseFloat(data.P) >= 0 ? 'positive-change' : 'negative-change';
            }
        };
    </script>
}
